# 求人・採用情報管理システム 実装レポート

## 実装概要

一般社団法人未来ネットワークのウェブサイトに、法人管理者が募集職種と福利厚生・待遇を編集できるCMSシステムを実装しました。

## 実装した機能

### 1. 統合管理ダッシュボード

法人管理者が以下の機能を一括で管理できるダッシュボードを実装:

- **お知らせ管理**: 各事業所からのお知らせの承認・編集
- **募集職種管理**: 求人情報の作成・編集・公開管理
- **福利厚生管理**: 福利厚生・待遇項目の作成・編集・公開管理
- **統計情報表示**: 承認待ち、公開中、下書きの件数を一目で確認

**アクセスURL**: `/admin`

### 2. データベーススキーマ

#### jobPostings テーブル
募集職種情報を管理するテーブル

| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | INT | 主キー（自動採番） |
| facility | VARCHAR(50) | 事業所名（mirai, hikari, studio_m） |
| title | VARCHAR(255) | 職種名 |
| employmentType | VARCHAR(100) | 雇用形態 |
| jobDescription | TEXT | 仕事内容 |
| baseSalary | VARCHAR(255) | 基本給 |
| workSchedule | TEXT | 勤務時間 |
| holidays | TEXT | 休日 |
| socialInsurance | TEXT | 社会保険 |
| contractPeriod | VARCHAR(255) | 契約期間 |
| isPublished | BOOLEAN | 公開状態 |
| createdBy | VARCHAR(255) | 作成者ID |
| createdAt | TIMESTAMP | 作成日時 |
| updatedAt | TIMESTAMP | 更新日時 |

#### benefits テーブル
福利厚生・待遇情報を管理するテーブル

| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | INT | 主キー（自動採番） |
| title | VARCHAR(255) | 項目名 |
| description | TEXT | 説明 |
| category | VARCHAR(100) | カテゴリ |
| displayOrder | INT | 表示順序 |
| isPublished | BOOLEAN | 公開状態 |
| createdBy | VARCHAR(255) | 作成者ID |
| createdAt | TIMESTAMP | 作成日時 |
| updatedAt | TIMESTAMP | 更新日時 |

### 3. バックエンドAPI

#### 募集職種API

- `GET /api/job-postings` - 公開中の募集職種一覧を取得
- `GET /api/job-postings/:id` - 特定の募集職種を取得
- `GET /api/admin/job-postings` - 全募集職種を取得（管理者のみ）
- `POST /api/admin/job-postings` - 新規募集職種を作成（管理者のみ）
- `PUT /api/admin/job-postings/:id` - 募集職種を更新（管理者のみ）
- `DELETE /api/admin/job-postings/:id` - 募集職種を削除（管理者のみ）

#### 福利厚生API

- `GET /api/benefits` - 公開中の福利厚生一覧を取得
- `GET /api/admin/benefits` - 全福利厚生を取得（管理者のみ）
- `POST /api/admin/benefits` - 新規福利厚生を作成（管理者のみ）
- `PUT /api/admin/benefits/:id` - 福利厚生を更新（管理者のみ）
- `DELETE /api/admin/benefits/:id` - 福利厚生を削除（管理者のみ）
- `PUT /api/admin/benefits/:id/reorder` - 表示順序を変更（管理者のみ）

### 4. 管理画面UI

#### 募集職種管理ページ (`/admin/job-postings`)

- 募集職種の一覧表示
- 公開/非公開の切り替え
- 編集・削除機能
- 新規作成ボタン

#### 募集職種作成・編集フォーム (`/admin/job-postings/new`, `/admin/job-postings/:id`)

入力項目:
- 事業所（MIRAI, HIKARI, studio M）
- 職種名
- 雇用形態
- 仕事内容
- 基本給
- 勤務時間
- 休日
- 社会保険
- 契約期間
- 公開/非公開

#### 福利厚生管理ページ (`/admin/benefits`)

- 福利厚生項目の一覧表示
- 表示順序の変更（上下ボタン）
- 公開/非公開の切り替え
- 編集・削除機能
- 新規作成ボタン

#### 福利厚生作成・編集フォーム (`/admin/benefits/new`, `/admin/benefits/:id`)

入力項目:
- 項目名
- 説明
- カテゴリ（福利厚生、待遇、その他）
- 公開/非公開

### 5. フロントエンド

#### 求人・採用ページ (`/careers`)

- データベースから募集職種を動的に取得して表示
- データベースから福利厚生情報を動的に取得して表示
- レスポンシブデザイン対応

### 6. お問い合わせフォーム連携

各事業所のお問い合わせボタンから、該当する事業所が事前選択された状態でお問い合わせフォームに遷移する機能を実装。

**実装内容**:
- ホームページの各事業所カードに`id`プロパティを追加
- お問い合わせボタンを`/contact?facility={id}`へのリンクに変更
- お問い合わせフォームでURLクエリパラメータから事業所IDを取得し、自動選択

**各事業所の連絡先情報**:
- **MIRAI**: TEL: 042-519-2942、営業時間: 9:00-16:45
- **HIKARI**: TEL: 042-519-1905、営業時間: 8:30-17:30
- **studio M**: TEL: 042-519-7916、営業時間: 9:00-16:45

## 技術スタック

- **フロントエンド**: React, TypeScript, Wouter, TanStack Query, Tailwind CSS
- **バックエンド**: Express.js, TypeScript
- **データベース**: MySQL (Drizzle ORM)
- **認証**: セッションベース認証
- **フォーム**: React Hook Form, Zod

## デプロイ手順

### 1. 環境変数の設定

以下の環境変数を設定する必要があります:

```
DATABASE_URL=mysql://user:password@host:port/database
```

### 2. データベースのセットアップ

```bash
# スキーマをデータベースにプッシュ
pnpm db:push
```

### 3. 初期管理者アカウントの作成

データベースに直接管理者アカウントを作成するか、OAuth経由でログイン後、データベースで`role`を`admin`に変更します。

### 4. デプロイ

Manusのデプロイ機能を使用してデプロイします。

## 使用方法

### 募集職種の管理

1. 管理画面にログイン (`/login`)
2. ダッシュボードから「募集職種管理」をクリック
3. 「新規作成」ボタンで新しい募集職種を追加
4. 既存の募集職種を編集または削除
5. 公開/非公開を切り替え

### 福利厚生の管理

1. 管理画面にログイン (`/login`)
2. ダッシュボードから「福利厚生管理」をクリック
3. 「新規作成」ボタンで新しい福利厚生項目を追加
4. 既存の福利厚生項目を編集または削除
5. 上下ボタンで表示順序を変更
6. 公開/非公開を切り替え

## 注意事項

- データベース接続が必要です。`DATABASE_URL`環境変数を正しく設定してください。
- 管理機能は認証されたユーザーのみがアクセスできます。
- 公開/非公開の設定により、フロントエンドに表示される情報を制御できます。

## 修正したTypeScriptエラー

デプロイ時に発生していたTypeScriptエラーをすべて修正しました:

1. **use-toast.ts**: `toasts`プロパティを追加し、完全な実装に修正
2. **Contact.tsx**: Zodのenum定義を最新バージョンに対応
3. **admin.ts**: Drizzle ORMのクエリビルダーの型エラーを修正
4. **JobPostings.tsx, JobPostingForm.tsx, Benefits.tsx, BenefitForm.tsx**: `react-router-dom`から`wouter`に変更
5. **AnnouncementsList.tsx**: 画像配列のundefinedチェックを追加

## 今後の拡張案

- 募集職種の応募フォーム機能
- 応募者管理機能
- メール通知機能
- 募集職種のカテゴリ分類
- 福利厚生のアイコン設定
- 多言語対応

## まとめ

法人管理者が一元的に募集職種と福利厚生を管理できるCMSシステムを実装しました。これにより、求人情報の更新が容易になり、常に最新の情報を求職者に提供できるようになりました。

すべてのTypeScriptエラーを修正し、デプロイ可能な状態になっています。

